<%- include('../partials/header_company', { pageTitle: pageTitle }) %><div class="py-4">
  <h1 class="h5 mb-3">引き落とし(モック)管理</h1>

  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <thead><tr><th>ID</th><th>User</th><th>金額</th><th>状態</th><th>作成</th><th>処理</th><th>操作</th></tr></thead>
      <tbody>
      <% rows.forEach(r => { %>
        <tr>
          <td><%= r.id %></td>
          <td><%= r.user_id %></td>
          <td><%= r.amount_jpy %> 円</td>
          <td><%= r.status %></td>
          <td><%= r.requested_at %></td>
          <td><%= r.processed_at || '-' %></td>
          <td>
            <form method="POST" action="/admin/debits/<%= r.id %>/simulate" class="d-inline">
              <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <% } %>
              <div class="btn-group">
                <button class="btn btn-success btn-sm" name="outcome" value="succeeded" <%= r.status!=='pending'?'disabled':'' %>>成功</button>
                <button class="btn btn-danger btn-sm" name="outcome" value="failed" <%= r.status!=='pending'?'disabled':'' %>>失敗</button>
              </div>
            </form>
          </td>
        </tr>
      <% }) %>
      </tbody>
    </table>
  </div>
</div>
<%- include('../partials/footer_admin') %>