<%- include('../partials/header_admin', { title: '通知ログ', user }) %>

<div class="page-header d-flex justify-content-between align-items-center">
  <h1 class="h5 mb-0">通知ログ</h1>
  <!-- 任意でフィルタや検索を置く -->
</div>

<div class="card card-rounded shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover table-sm mb-0 table-nowrap">
      <thead class="table-light">
        <tr>
          <th>ID</th><th>日時</th><th>チャネル</th><th>宛先</th><th>件名</th>
          <th>状態</th><th>試行</th><th class="min-w-240">エラー</th><th>操作</th>
        </tr>
      </thead>
      <tbody>
        <% (logs || []).forEach(log => { %>
          <tr>
            <td><%= log.id %></td>
            <td><%= log.sent_at || log.created_at %></td>
            <td><span class="badge bg-secondary"><%= log.channel %></span></td>
            <td><%= log.to_email %></td>
            <td><%= log.subject %></td>
            <td>
              <% if (log.status === 'delivered') { %>
                <span class="badge bg-success">delivered</span>
              <% } else if (log.status === 'failed') { %>
                <span class="badge bg-danger">failed</span>
              <% } else { %>
                <span class="badge bg-warning text-dark"><%= log.status %></span>
              <% } %>
            </td>
            <td><%= log.attempts %></td>
            <td class="text-truncate max-w-320"><%= log.last_error || '' %></td>
            <td>
              <form method="post" action="/admin/notifications/<%= log.id %>/resend">
                <%- include('partials/csrf') %>
                <button class="btn btn-primary btn-sm">再送</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<%- include('../partials/footer') %>
