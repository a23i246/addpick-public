<%- include('partials/header_company', { title: '購入された履歴', user }) %>

<div class="container mt-5">
  <h2 class="mb-4">あなたの広告商品が購入された履歴</h2>

  <% if (purchases.length === 0) { %>
    <p class="text-muted">まだ購入された記録はありません。</p>
  <% } else { %>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>商品</th>
          <th>購入者</th>
          <th>単価</th>
          <th>数量</th>
          <th>合計</th>
          <th>購入日時</th>
          <th>対応状況</th>
        </tr>
      </thead>
      <tbody>
        <% purchases.forEach(p => { %>
          <tr>
            <td>
              <strong><%= p.product_name %></strong><br>
              <small><%= p.title %></small>
            </td>
            <td>
              <%= p.buyer_name %><br>
              <small><%= p.buyer_email %></small>
            </td>
            <td>¥<%= p.unit_price %></td>
            <td><%= p.quantity %> 個</td>
            <td>¥<%= p.unit_price * p.quantity %></td>
            <td><%= new Date(p.created_at).toLocaleString() %></td>
            <td>
              <% if (p.is_handled === 0) { %>
                <form action="/company/purchases/<%= p.id %>/handle" method="POST">
                  <%- include('partials/csrf') %>
                  <button type="submit" class="btn btn-sm btn-warning">対応待ち</button>
                </form>
              <% } else { %>
                <span class="badge bg-success">対応済み</span>
              <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } %>

  <div class="mt-3">
    <a href="/" class="btn btn-secondary">ホームに戻る</a>
  </div>
</div>

<%- include('partials/footer') %>
