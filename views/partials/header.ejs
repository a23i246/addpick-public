<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title><%= typeof pageTitle !== 'undefined' ? pageTitle : 'AddPick' %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS（CDN） -->
   <link rel="stylesheet" href="/css/navbar.css">
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
</head>
<body class="bg-light">

<!-- ナビバー -->
<nav class="navbar navbar-dark bg-primary">
  <div class="container-fluid d-flex justify-content-between align-items-center">
    <a class="navbar-brand fw-bold m-0" href="/">AddPick</a>
    <button class="navbar-toggler" type="button"
            data-bs-toggle="offcanvas" data-bs-target="#mainMenu"
            aria-controls="mainMenu" aria-label="メニューを開く">
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>
</nav>

<!-- Offcanvas: 一般ユーザー用メニュー -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="mainMenu" aria-labelledby="mainMenuLabel">
  <div class="offcanvas-header bg-primary text-white">
    <h5 class="offcanvas-title" id="mainMenuLabel">メニュー</h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="閉じる"></button>
  </div>

  <div class="offcanvas-body">
    <!-- ユーザー情報（ログイン時） -->
    <% if (typeof user !== 'undefined' && user) { %>
      <div class="d-flex align-items-center mb-3">
        <img
          src="<%= user.profile_image ? ('/uploads/' + user.profile_image) : '/uploads/default-avatar.png' %>"
          alt="プロフィール画像"
          class="avatar-header"
        />
        <div class="ms-2">
          <div class="fw-bold"><%= user.name || user.username || 'ユーザー' %></div>
          <% if (user.email) { %><small class="text-muted"><%= user.email %></small><% } %>
          <% if (typeof withdrawableJPYFmt !== 'undefined' && withdrawableJPYFmt !== null) { %>
            <div class="mt-1">
              <small class="text-muted">引き落とせる金額</small>
              <div class="fw-bold">¥<%= withdrawableJPYFmt %></div>
            </div>
          <% } %>
        </div>
      </div>
    <% } %>

    <!-- メニュー項目 -->
    <div class="list-group list-group-flush mb-3">
      <% if (typeof user !== 'undefined' && user) { %>
        <a class="list-group-item list-group-item-action" href="/profile">プロフィールを見る</a>
        <a class="list-group-item list-group-item-action" href="/my_applications">応募履歴</a>
        <a class="list-group-item list-group-item-action" href="/sales_history">売上確認</a>
        <a class="list-group-item list-group-item-action" href="/my_purchases">購入履歴を見る</a>
        <!-- <a class="list-group-item list-group-item-action" href="/users">インフルエンサーを探す</a>
        <a class="list-group-item list-group-item-action" href="/following">フォロー済みインフルエンサー</a>
        <a class="list-group-item list-group-item-action" href="/followers">フォロワー一覧</a> -->
        <!--<a class="list-group-item list-group-item-action" href="/influencer/rewards">報酬統計</a>-->
        <!--<a class="list-group-item list-group-item-action" href="/cart">カートへ進む</a>-->
        <!-- 支払い（口座振替） -->
        <div class="list-group-item bg-light fw-bold">支払い（口座振替）</div>
        <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
          href="/billing/bank">
          口座設定（振込）
          <% if (typeof bankVerified !== 'undefined') { %>
            <% if (bankVerified) { %>
              <span class="badge bg-success">認証済</span>
            <% } else { %>
              <span class="badge bg-warning text-dark">未認証</span>
            <% } %>
          <% } %>
        </a>
        <a class="list-group-item list-group-item-action" href="/billing/debits/new">引き落としを作成</a>
        <a class="list-group-item list-group-item-action" href="/billing/debits">引き落とし履歴</a>

        <a class="list-group-item list-group-item-action" href="/">ホームに戻る</a>
      <% } else { %>
        <a class="list-group-item list-group-item-action" href="/login">ログイン</a>
        <a class="list-group-item list-group-item-action" href="/register">新規登録</a>
        <a class="list-group-item list-group-item-action" href="/">ホームに戻る</a>
      <% } %>
    </div>

    <div class="d-grid gap-2">
      <% if (typeof user !== 'undefined' && user) { %>
        <a class="btn btn-outline-secondary" href="/select_role">ロール切り替え</a>
        <!-- <form action="/logout" method="POST" class="m-0">
          <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
          <% } %>
          <button class="btn btn-outline-danger w-100" type="submit">ログアウト</button>
        </form> -->
      <% } %>
    </div>
  </div>
</div>

<!-- ページ本体 -->
<div class="container">
